import React, { useState, useEffect } from 'react';
import { useParams, useNavigate } from 'react-router-dom';
import axios from 'axios';
import './App.css';

const CustomerOrderStatus2 = () => {
  const { tableNumber } = useParams();
  const navigate = useNavigate();
  const [order, setOrder] = useState(null);
  const [additionalFood, setAdditionalFood] = useState('');
  const firebaseHostingUrl = "https://tabletap-27cd3.web.app"; // Replace with your actual Firebase Hosting URL

  useEffect(() => {
    const fetchOrderStatus = async () => {
      try {
        const response = await axios.get(`${firebaseHostingUrl}/api/order-status/${tableNumber}`);
        setOrder(response.data);
      } catch (error) {
        console.error('Error fetching order status:', error);
      }
    };

    fetchOrderStatus();
  }, [tableNumber]);

  const handleAddFood = async (e) => {
    e.preventDefault();
    try {
      await axios.post(`${firebaseHostingUrl}/api/add-food`, { tableNumber, additionalFood });
      alert('Food added successfully');
      setAdditionalFood('');
    } catch (error) {
      console.error('Error adding food:', error);
      alert('Failed to add food');
    }
  };

  if (order && order.status === 'Done') {
    return (
      <div className="container">
        <h1>Thank you for dining with us!</h1>
      </div>
    );
  }

  if (!order || order.status === 'No Order') {
    return (
      <div className="container">
        <h1>Welcome to my restaurant!</h1>
        <button onClick={() => navigate(`/form/${tableNumber}`)}>Order</button>
      </div>
    );
  }

  return (
    <div className="container">
      <h1>Order Status for Table {tableNumber}</h1>
      {order ? (
        <div>
          <p>Name: {order.name}</p>
          <p>Order: {order.order}</p>
          <p>Status: {order.status}</p>
          <form onSubmit={handleAddFood}>
            <div className="form-group">
              <label>Add More Food:</label>
              <input type="text" value={additionalFood} onChange={(e) => setAdditionalFood(e.target.value)} />
            </div>
            <button type="submit">Add Food</button>
          </form>
        </div>
      ) : (
        <p>No order found for this table</p>
      )}
    </div>
  );
};

export default CustomerOrderStatus2;